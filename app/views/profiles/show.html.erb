<div class="container mt-4">
  <h1><%= @user.first_name %> <%= @user.last_name %>'s Profile</h1>

  <div class="row mt-3">
    <% if @user.profile_pic.present? %>
      <div class="col-md-2">
        <img src="<%= @user.profile_pic %>" alt="Profile Picture" class="img-thumbnail">
      </div>
    <% end %>
    <div class="col-md-10">
      <h2>User Information:</h2>
      <p><strong>Email:</strong> <%= @user.email %></p>
      <p><strong>Major:</strong> <%= @user.major %></p>
    </div>
  </div>

  <div class="mt-3">
    <h2>Course History:</h2>
    <%= check_box_tag :show_grades, '1', true, id: 'show_grades', onclick: 'toggleGrades()' %>
    <label for="show_grades">Show Grades</label>
    <% if @course_enrollments.any? %>
      <table class="table table-striped" id="enrolled_courses">
        <thead>
          <tr>
            <th>Course</th>
            <th>Year</th>
            <th class="grade-column">Grade</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @course_enrollments.each_with_index do |enrollment, index| %>
            <tr class="<%= 'course-row' if index >= 5 %>">
              <td><%= enrollment.course.course_number %></td>
              <td><%= enrollment.year %></td>
              <td class="grade-column"><%= enrollment.grade %></td>
              <td>
                <%= link_to 'Edit', edit_user_course_enrollment_path(@user, enrollment) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <% if @course_enrollments.size > 5 %>
        <p id="toggle_courses" onclick="toggleCourses()" style="cursor:pointer;">
          Show More
        </p>
      <% end %>
    <% else %>
      <p>No course history available.</p>
    <% end %>
  </div>

  <div class="mt-3">
    <h2>Add Course:</h2>
    <%= form_for([@user, CourseEnrollment.new]) do |f| %>
      <div class="form-group">
        <%= f.label :course, 'Course' %>
        <%= f.collection_select :course, Course.all, :course_number, :course_number, { include_blank: true }, { class: 'form-control', required: true } %>
      </div>
      <div class="form-group">
        <%= f.label :year, 'Year' %>
        <%= f.number_field :year, in: 1900..Date.today.year, class: 'form-control', required: true %>
      </div>
      <div class="form-group">
        <%= f.label :grade, 'Grade' %>
        <%= f.text_field :grade, class: 'form-control', required: true %>
      </div>
      <%= f.submit 'Add Course', class: 'btn btn-primary' %>
    <% end %>
  </div>

  <div class="mt-3">
    <h2>Course Recommendations:</h2>
    <!-- Recommendations form stays the same -->
  </div>
</div>

<script>
  function toggleCourses() {
    var rows = document.querySelectorAll('.course-row');
    for (var i = 0; i < rows.length; i++) {
      rows[i].style.display = rows[i].style.display === 'none' ? '' : 'none';
    }
    var toggleText = document.getElementById('toggle_courses');
    toggleText.textContent = toggleText.textContent === 'Show More' ? 'Show Less' : 'Show More';
  }

  function toggleGrades() {
    var grades = document.querySelectorAll('.grade-column');
    for (var i = 0; i < grades.length; i++) {
      grades[i].style.display = grades[i].style.display === 'none' ? '' : 'none';
    }
    var showGradesCheckbox = document.getElementById('show_grades');
    var label = document.querySelector('label[for="show_grades"]');
    label.textContent = showGradesCheckbox.checked ? 'Hide Grades' : 'Show Grades';
  }

  // Initially hide rows if more than 5 courses and grades are not to be shown
  document.addEventListener('DOMContentLoaded', (event) => {
    if (document.querySelectorAll('.course-row').length > 5) {
      toggleCourses();
    }
    toggleGrades();
  });
</script>
